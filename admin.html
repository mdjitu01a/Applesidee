<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>অ্যাপল সাইড - অ্যাডমিন প্যানেল</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root { --primary:#1e88e5; --danger:#e53935; --success:#43a047; --warning:#fb8c00; --approved:#1b5e20; --light:#f8f9fa; }
body{font-family:Arial,sans-serif;background:var(--light);padding:15px;}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:9999;}
.modal-content{background:white;padding:30px;border-radius:12px;width:90%;max-width:400px;text-align:center;}
.btn{padding:10px 20px;border-radius:8px;cursor:pointer;border:none;font-weight:bold;margin:5px;}
.btn-primary{background:var(--primary);color:white;}
.btn-danger{background:var(--danger);color:white;}
.btn-success{background:var(--success);color:white;}
h1,h2{text-align:center;color:var(--primary);}
form{background:white;padding:20px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.1);margin:20px 0;}
input,select{width:100%;padding:12px;margin:8px 0;border:1px solid #ddd;border-radius:6px;}
table{width:100%;border-collapse:collapse;margin:20px 0;background:white;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
th,td{padding:12px;text-align:left;border-bottom:1px solid #ddd;}
th{background:var(--primary);color:white;}
.status-Pending{color:var(--warning);font-weight:bold;}
.status-Confirmed{color:var(--primary);font-weight:bold;}
.status-Delivered{color:var(--success);font-weight:bold;}
.status-Cancelled{color:var(--danger);font-weight:bold;}
.actions select{padding:6px;border-radius:6px;}
.product-item{background:white;padding:15px;margin-bottom:15px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
.product-item img{max-width:100%;height:180px;object-fit:contain;border-radius:8px;}
.actions button{margin:2px;padding:6px 12px;font-size:0.9rem;}
</style>
</head>
<body>

<!-- লগইন মোডাল -->
<div class="modal" id="adminLoginModal" style="display:flex;">
<div class="modal-content">
<h2>অ্যাডমিন লগইন</h2>
<input type="password" id="adminPass" placeholder="পাসওয়ার্ড দিন" style="margin:20px 0;">
<button onclick="checkAdmin()" class="btn btn-primary" style="width:100%;">লগইন</button>
</div>
</div>

<!-- অ্যাডমিন প্যানেল -->
<div id="adminContent" style="display:none;">
<h1>অ্যাপল সাইড - অ্যাডমিন প্যানেল</h1>
<button onclick="location.reload()" class="btn btn-danger" style="float:right;">লগআউট</button>

<!-- প্রোডাক্ট যোগ -->
<div class="section">
<h2>নতুন প্রোডাক্ট যোগ করুন</h2>
<form id="productForm">
<input type="text" id="name" placeholder="প্রোডাক্টের নাম" required>
<input type="number" id="price" placeholder="দাম (৳)" required>
<input type="number" id="oldPrice" placeholder="আগের দাম (৳)">
<input type="file" id="imageFile" accept="image/*" required>
<div id="preview" style="margin:10px 0;"></div>
<input type="text" id="category" placeholder="ক্যাটাগরি (airpods/powerbank/selfie)" required>
<input type="number" id="stock" placeholder="স্টক (পরিমাণ)" value="10" min="0">
<button type="submit" class="btn btn-primary" style="width:100%; margin-top:15px;">প্রোডাক্ট যোগ করুন</button>
</form>
</div>

<!-- প্রোডাক্ট লিস্ট -->
<div class="section">
<h2>সকল প্রোডাক্ট</h2>
<div id="adminProductList"></div>
</div>

<!-- অর্ডার লিস্ট -->
<div class="section">
<h2>সকল অর্ডার</h2>
<table>
<thead>
<tr>
<th>অর্ডার আইডি</th>
<th>প্রোডাক্ট</th>
<th>পরিমাণ</th>
<th>টোটাল দাম</th>
<th>নাম</th>
<th>ফোন</th>
<th>ঠিকানা</th>
<th>পেমেন্ট টাইপ</th>
<th>মেথড</th>
<th>TrxID</th>
<th>স্ক্রিনশট</th>
<th>সময়</th>
<th>স্ট্যাটাস</th>
<th>অ্যাকশন</th>
</tr>
</thead>
<tbody id="orderTableBody"></tbody>
</table>
</div>
</div>

<script>
const API_URL='https://script.google.com/macros/s/AKfycbwK2QXSp1i-s8cD5hEVp_0ONKzCbSyZxr2NEzobJlHdzlmxDN97a32sh1ADJgyqa-kW/exec';
const ADMIN_PASSWORD="123456";
let orders=[],products=[];

function checkAdmin(){
    if(document.getElementById('adminPass').value===ADMIN_PASSWORD){
        document.getElementById('adminLoginModal').style.display='none';
        document.getElementById('adminContent').style.display='block';
        loadOrders(); loadProducts();
    }else{ alert("ভুল পাসওয়ার্ড!"); }
}

// --- অর্ডার লিস্ট ---
async function loadOrders(){
    try{
        const res=await fetch(API_URL+'?action=getOrders');
        orders=await res.json();
        renderOrders();
    }catch(err){ console.error('অর্ডার লোড হয়নি:',err);}
}
function renderOrders(){
    const tbody=document.getElementById('orderTableBody');
    tbody.innerHTML='';
    orders.forEach(o=>{
        const row=document.createElement('tr');
        row.innerHTML=`
<td>${o.id}</td>
<td>${o.product}</td>
<td>${o.quantity}</td>
<td>৳${o.total}</td>
<td>${o.customerName}</td>
<td>${o.phone}</td>
<td>${o.address}</td>
<td>${o.paymentType}</td>
<td>${o.paymentMethod||'N/A'}</td>
<td>${o.trxId||'N/A'}</td>
<td>${o.screenshot||'N/A'}</td>
<td>${o.time}</td>
<td class="status-${o.status}">${o.status}</td>
<td class="actions">
<select onchange="updateOrderStatus('${o.id}',this.value)">
<option value="Pending" ${o.status==='Pending'?'selected':''}>Pending</option>
<option value="Confirmed" ${o.status==='Confirmed'?'selected':''}>Confirmed</option>
<option value="Delivered" ${o.status==='Delivered'?'selected':''}>Delivered</option>
<option value="Cancelled" ${o.status==='Cancelled'?'selected':''}>Cancelled</option>
</select>
</td>`;
        tbody.appendChild(row);
    });
}
async function updateOrderStatus(id,status){
    try{
        const res=await fetch(API_URL,{method:'POST',body:JSON.stringify({action:"updateOrderStatus",id:id,status:status})});
        const result=await res.json();
        if(result.status==="success"){ loadOrders(); }else{ alert("সমস্যা হয়েছে: "+result.message);}
    }catch(err){ alert("ইন্টারনেট চেক করো"); }
}

// --- প্রোডাক্ট লিস্ট ---
async function loadProducts(){
    try{
        const res=await fetch(API_URL);
        products=await res.json();
        renderProducts();
    }catch(err){ console.error('প্রোডাক্ট লোড হয়নি:',err);}
}
function renderProducts(){
    const list=document.getElementById('adminProductList');
    list.innerHTML='';
    products.forEach(p=>{
        const item=document.createElement('div');
        item.className='product-item';
        item.innerHTML=`
<h3>${p.name}</h3>
<p>দাম: ৳${p.price} ${p.old?`(আগের: ৳${p.old})`:''}</p>
<p>ক্যাটাগরি: ${p.category}</p>
<p>স্টক: ${p.stock||'N/A'}</p>
<img src="${p.img}">
<div class="actions">
<button onclick="deleteProduct('${p.id}')" class="btn btn-danger">ডিলিট</button>
</div>`;
        list.appendChild(item);
    });
}

document.getElementById('productForm').addEventListener('submit',e=>{
    e.preventDefault();
    const file=document.getElementById('imageFile').files[0];
    if(!file){ alert("ছবি সিলেক্ট করুন"); return; }
    const reader=new FileReader();
    reader.onload=async ev=>{
        const newProduct={
            action:"addProduct",
            id:Date.now().toString(),
            name:document.getElementById('name').value.trim(),
            price:parseInt(document.getElementById('price').value)||0,
            old:parseInt(document.getElementById('oldPrice').value)||null,
            img:ev.target.result,
            category:document.getElementById('category').value.trim().toLowerCase(),
            stock:parseInt(document.getElementById('stock').value)||0
        };
        try{
            const res=await fetch(API_URL,{method:'POST',body:JSON.stringify(newProduct)});
            const result=await res.json();
            if(result.status==='success'){ alert("প্রোডাক্ট যোগ হয়েছে!"); e.target.reset(); document.getElementById('preview').innerHTML=''; loadProducts(); }
            else{ alert("সমস্যা হয়েছে: "+result.message); }
        }catch(err){ alert("ইন্টারনেট চেক করো: "+err.message);}
    };
    reader.readAsDataURL(file);
});

document.getElementById('imageFile').addEventListener('change',e=>{
    const file=e.target.files[0];
    if(file){
        const reader=new FileReader();
        reader.onload=ev=>{ document.getElementById('preview').innerHTML=`<img src="${ev.target.result}" style="max-width:220px; max-height:220px; object-fit:contain; margin-top:10px; border-radius:8px;">`; };
        reader.readAsDataURL(file);
    }
});

async function deleteProduct(id){
    if(!confirm("আপনি কি এই প্রোডাক্ট ডিলিট করতে চান?")) return;
    try{
        const res=await fetch(API_URL,{method:'POST',body:JSON.stringify({action:"deleteProduct",id:id})});
        const result=await res.json();
        if(result.status==="success"){ alert("ডিলিট সম্পন্ন"); loadProducts(); }else{ alert("সমস্যা হয়েছে: "+result.message);}
    }catch(err){ alert("ইন্টারনেট চেক করো"); }
}
</script>

</body>
</html>
